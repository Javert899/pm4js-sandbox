<html>
	<head>
		<script src="scripts/generic/jquery.min.js"></script>
		<script src="scripts/generic/download-utility.js"></script>
		<script src="scripts/pm4js/eventLog.js"></script>
		<script src="scripts/pm4js/xesParser.js"></script>
		<script src="scripts/pm4js/xesExporter.js"></script>
		<script src="scripts/pm4js/log-statistics.js"></script>
		<script src="scripts/pm4js/dfg.js"></script>
		<script src="scripts/generic/mxClient.min.js"></script>
		<script src="logs/example-jsonocel.js"></script>
		<script src="scripts/ocel/eventsView.js"></script>
		<script src="scripts/ocel/objectsView.js"></script>
		<script src="scripts/ocel/edgesView.js"></script>
		<script src="scripts/ocel/ocdfg-model.js"></script>
		<script src="scripts/ocel/ocdfg-visualization.js"></script>
		<script src="scripts/ocel/xmlocel-exporter.js"></script>
		<script src="scripts/ocel/xmlocel-importer.js"></script>
		<script src="scripts/ocel/ocel-flattening.js"></script>
	</head>
	<body>
		<div id="header">
			Annotation:
			<select id="annotationSelector">
				<option id="events" value="0">Events</option>
				<option id="unique_objects" value="1" selected>Unique Objects</option>
				<option id="total_objects" value="2">Total Objects</option>
			</select>
			% act.: <input id="af_slider" type="range" min="0" max="100" value="70" class="slider">
			% paths: <input id="pf_slider" type="range" min="0" max="100" value="70" class="slider">
			<button id="apply_changes" onclick="doVisualization()">Apply Changes</button>
			<button id="reset_filters" onclick="resetFilters()">Reset Filters</button>
			Select the object types: <select id="objectTypes" multiple style="height: 40px">
			</select>
			<button id="filterObjectTypes" onclick="filterObjectTypes()">Filter on Obj Types</button><br />
			Selected activity: <span id="selectedActivity"></span>
			<button id="filterRelatedObjectsActivity" onclick="filterRelatedObjectsActivity()" disabled>Filter Rel.Obj</button>
			<button id="filterNonRelatedObjectsActivity" onclick="filterNonRelatedObjectsActivity()" disabled>Filter Non Rel.Obj</button>
			<button id="filterNonStartingWith" onclick="filterNonStartingWith()" disabled>Filter Non Starting With</button>
			<button id="filterNonEndingWith" onclick="filterNonEndingWith()" disabled>Filter Non Ending With</button>
			<button id="seeRelatedObjAct" onclick="seeRelatedObjAct()" disabled>See Rel.Obj.</button><br />
			Selected edge: <span id="selectedEdge"></span>
			<button id="filterRelatedObjectsEdge" onclick="filterRelatedObjectsEdge()" disabled>Filter Rel.Obj</button>
			<button id="filterNonRelatedObjectsEdge" onclick="filterNonRelatedObjectsEdge()" disabled>Filter Non Rel.Obj</button>
			<button id="seeRelatedObjEdge" onclick="seeRelatedObjEdge()" disabled>See Rel.Obj. Edge</button><br />
		</div>
		<div id="graphContainer">
		</div>
		<script type="text/javascript">
			let model = new OcdfgModel(eventLog);
			let visualization = new OcdfgVisualization(model, "graphContainer");
			let selectedActivity = null;
			let selectedOt = null;
			let selectedEdge = null;
			
			function doVisualization() {
				let af = document.getElementById("af_slider").value / 100.0;
				let pf = document.getElementById("pf_slider").value / 100.0;
				let annotation = parseInt(document.getElementById("annotationSelector").value);
				visualization.ACTIVITY_FREQUENCY = af;
				visualization.PATHS_FREQUENCY = pf;
				visualization.IDX = annotation;
				visualization.represent();
			}
			
			function resetFilters() {
				visualization.resetFilters();
				doVisualization();
			}
			
			function filterObjectTypes() {
			
			}
			
			function filterRelatedObjectsActivity() {
			
			}
			
			function filterNonRelatedObjectsActivity() {
			
			}
			
			function filterNonStartingWith() {
			
			}
			
			function filterNonEndingWith() {
			
			}
			
			function seeRelatedObjAct() {
			
			}
			
			function filterRelatedObjectsEdge() {
			
			}
			
			function filterNonRelatedObjectsEdge() {
			
			}
			
			function seeRelatedObjEdge() {
			
			}
			
			function callbackActivity(activity, ot) {
				selectedActivity = activity;
				selectedOt = ot;
				if (selectedActivity != null) {
					document.getElementById("filterRelatedObjectsActivity").disabled = false;
					document.getElementById("seeRelatedObjAct").disabled = false;
					if (selectedOt != null) {
						document.getElementById("selectedActivity").innerHTML = selectedActivity+" ("+selectedOt+")";
						document.getElementById("filterNonRelatedObjectsActivity").disabled = false;
						document.getElementById("filterNonStartingWith").disabled = false;
						document.getElementById("filterNonEndingWith").disabled = false;
					}
					else {
						document.getElementById("selectedActivity").innerHTML = selectedActivity;
						document.getElementById("filterNonRelatedObjectsActivity").disabled = true;
						document.getElementById("filterNonStartingWith").disabled = true;
						document.getElementById("filterNonEndingWith").disabled = true;
					}
				}
			}
			
			function callbackEdge(edge) {
				selectedEdge = edge;
				document.getElementById("selectedEdge").innerHTML = selectedEdge.toString();
				document.getElementById("filterRelatedObjectsEdge").disabled = false;
				document.getElementById("filterNonRelatedObjectsEdge").disabled = false;
				document.getElementById("seeRelatedObjEdge").disabled = false;
			}
			
			visualization.callbackActivity = callbackActivity;
			visualization.callbackEdge = callbackEdge;
			doVisualization();
			/*$.get('logs/log.xmlocel', function(data) {
				let ocel = XmlOcelImporter.importLog(data);
				console.log(ocel);
				let log = OcelFlattening.flatten(ocel, "DOCTYPE_Order");
				console.log(log);
			});*/
			
			//let xmlStri = XmlOcelExporter.exportLog(model.ocel);
			//download(xmlStri, "prova.xmlocel", "text/xml");
			

			//console.log(xmlStri);
			//console.log(new Date().getTime());
			//let log = null;
			//$.get('logs/receipt.xes', function(data) {
			//	console.log("parsing");
			//	log = XesParser.parse(data);
			//	console.log(log);
			//	let aa = (new Date()).getTime();
			//	let sa = LogStatistics.getStartActivities(log);
			//	let ea = LogStatistics.getEndActivities(log);
			//	let att = LogStatistics.getAttributeValues(log, "concept:name");
			//	let vars = LogStatistics.getVariants(log);
			//	let bb = (new Date()).getTime();
			//	let aa = (new Date()).getTime();
			//	let dfg = new Dfg(log);
				//let fdfg = dfg.calculateFrequencyDfg();
			//	let pdfg = dfg.calculatePerformanceDfg();
			//	let bb = (new Date()).getTime();
			//	console.log((bb-aa)/1000.0);
			//	console.log(pdfg);
				//console.log(pdfg);
			//});
		</script>
	</body>
</html>